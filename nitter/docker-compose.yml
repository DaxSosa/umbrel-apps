version: "2023.05.20"

services:
  app_proxy:
    environment:
      APP_HOST: nitter_web_1
      APP_PORT: 8080

  web:
    # Official Nim image used as base image for nitter doesn't offer Arm variant so using a custom image w/ patch for umbrel
    # https://github.com/ceramicwhite/umbrel-patch-ci/blob/master/nitter/umbrel.patch
    image: zedeus/nitter:latest@sha256:2172275e119f39e5e2e4d554bf1bd70feae70ac872818ede2c1d566e601678ae
    restart: on-failure
    stop_grace_period: 1m
    init: true
    user: 1000:1000
    environment:
      REDIS_HOST: "nitter_redis_1"
      REDIS_PASS: "moneyprintergobrrr"
      NITTER_THEME: '"auto_(twitter)"'
    volumes:
      - ${APP_DATA_DIR}/data/nitter:/data
    depends_on:
      - redis
  
  redis:
    image: redis:6.2.2-buster@sha256:e10f55f92478715698a2cef97c2bbdc48df2a05081edd884938903aa60df6396
    restart: on-failure
    stop_grace_period: 1m
    user: 1000:1000
    command: "redis-server --save 60 1 --loglevel warning --requirepass moneyprintergobrrr"
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data
